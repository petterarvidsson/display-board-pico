#include "pico/stdlib.h"
#include "stdio.h"
#include "pio_display.h"
#include "i2c-controller.h"

static uint32_t data[] = {
  1 << 16, 0x8d14afe3,
  1 << 16, 0xe3B00210,
  (32 << 16) | 1,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  1 << 16, 0xe3B10210,
  (32 << 16) | 1,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  1 << 16, 0xe3B20210,
  (32 << 16) | 1,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  1 << 16, 0xe3B30210,
  (32 << 16) | 1,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  1 << 16, 0xe3B40210,
  (32 << 16) | 1,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  1 << 16, 0xe3B50210,
  (32 << 16) | 1,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  1 << 16, 0xe3B60210,
  (32 << 16) | 1,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  1 << 16, 0xe3B70210,
  (32 << 16) | 1,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,

  1 << 16 | 2, 0x8d14afe3,
  1 << 16, 0xe3B00210,
  (32 << 16) | 1,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  1 << 16, 0xe3B10210,
  (32 << 16) | 1,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  1 << 16, 0xe3B20210,
  (32 << 16) | 1,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  1 << 16, 0xe3B30210,
  (32 << 16) | 1,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  1 << 16, 0xe3B40210,
  (32 << 16) | 1,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  1 << 16, 0xe3B50210,
  (32 << 16) | 1,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  1 << 16, 0xe3B60210,
  (32 << 16) | 1,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  1 << 16, 0xe3B70210,
  (32 << 16) | 1,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003,
  0x00000003, 0x00000003, 0x00000003, 0x00000003 ,0x00000003, 0x00000003, 0x00000003, 0x00000003
};

int main() {
    stdio_init_all();
    pio_display_init();
    i2c_controller_init();

    int32_t value = 0;
    for(;;) {
      absolute_time_t start = get_absolute_time();
      pio_display_update(data, sizeof(data) / sizeof(*data));
      int32_t new_value = i2c_controller_update_blocking();
      absolute_time_t i2c_end = get_absolute_time();
      pio_display_wait_for_finish_blocking();
      absolute_time_t end = get_absolute_time();
      if(new_value != value) {
        value = new_value;
        printf("VALUE: %d TIME I2C: %lluus TOTAL %lluus\n", value, absolute_time_diff_us(start, i2c_end), absolute_time_diff_us(start, end));
      }
    }
}
