#include "pico/stdlib.h"
#include "stdio.h"
#include "pio_display.h"
#include "i2c_controller.h"

static uint32_t data[] = {
  1 << 16, 0xe3B00210,
  (32 << 16) | 1,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  1 << 16, 0xe3B10210,
  (32 << 16) | 1,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  1 << 16, 0xe3B20210,
  (32 << 16) | 1,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  1 << 16, 0xe3B30210,
  (32 << 16) | 1,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  1 << 16, 0xe3B40210,
  (32 << 16) | 1,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  1 << 16, 0xe3B50210,
  (32 << 16) | 1,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  1 << 16, 0xe3B60210,
  (32 << 16) | 1,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  1 << 16, 0xe3B70210,
  (32 << 16) | 1,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
  0x00000001, 0x00000001, 0x00000001, 0x00000001 ,0x00000001, 0x00000001, 0x00000001, 0x00000001,
};

static uint32_t data2[] = {
  1 << 16, 0xe3B00210,
  (32 << 16) | 1,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  1 << 16, 0xe3B10210,
  (32 << 16) | 1,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  1 << 16, 0xe3B20210,
  (32 << 16) | 1,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  1 << 16, 0xe3B30210,
  (32 << 16) | 1,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  1 << 16, 0xe3B40210,
  (32 << 16) | 1,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  1 << 16, 0xe3B50210,
  (32 << 16) | 1,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  1 << 16, 0xe3B60210,
  (32 << 16) | 1,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  1 << 16, 0xe3B70210,
  (32 << 16) | 1,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
  0x01010101, 0x01010101, 0x01010101, 0x01010101 ,0x01010101, 0x01010101, 0x01010101, 0x01010101,
};


static const size_t data_size = sizeof(data) / sizeof(*data);
static const size_t data2_size = sizeof(data) / sizeof(*data);

static uint32_t *current_data = data;

int main() {
    stdio_init_all();
    pio_display_init();
    i2c_controller_init();

    int32_t value = 0;
    for(;;) {
      int32_t new_value = i2c_controller_update_blocking();

      if(new_value != value) {
        value = new_value;
        absolute_time_t start = get_absolute_time();
        pio_display_update(current_data, data_size);
        pio_display_wait_for_finish_blocking();
        absolute_time_t end = get_absolute_time();
        printf("SIZE: %d CURRENT: %d VALUE: %d TIME %lluus\n", data_size, current_data, value, absolute_time_diff_us(start, end));
        if(current_data == data) {
          current_data = data2;
        } else {
          current_data = data;
        }
      }
    }
}
